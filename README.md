# adoctl

Azure DevOps decomposition outbox + writer CLI.

This tool is designed to take **agent-generated decompositions** (Features + User Stories) in a canonical JSON “bundle” format, validate them against **team policy** and **ADO-derived metadata**, then (eventually) bulk-create the work items in Azure DevOps safely.

## Quickstart

Assumes:

- conda `4.9.2`
- Python `3.8.5`

- Create conda env: `conda env create -f environment.yml`
- Activate: `conda activate adoctl`
- Run: `python -m adoctl sync --help`

If you want an `adoctl` executable in the env:

- `pip install -e .`

## Repository Layout

### `adoctl/`

Python package for the CLI and supporting modules.

- `adoctl/cli/` — CLI entrypoints and argument parsing.
- `adoctl/ado_client/` — ADO REST client primitives (auth, HTTP, config models).
- `adoctl/sync/` — “sync” implementation (ADO → `config/generated/*`).
- `adoctl/config/` — repo path helpers and config composition utilities (will expand).
- `adoctl/util/` — small utilities (filesystem, formatting, etc.).

### `config/`

Layered configuration (do not mix responsibilities between layers).

- `config/policy/` — team governance rules (human-authored).
  - `link_policy.yaml` — allowed link types and hierarchy rules.
  - `standards.yaml` — naming/tagging conventions.
  - `field_policy.yaml` — allowed/required canonical fields beyond ADO.
  - `kr_taxonomy.yaml` — KR taxonomy used for tags/governance.
- `config/generated/` — ADO-derived facts (generated by `adoctl sync`; never hand-edit).
  - `projects.yaml` — org projects snapshot.
  - `teams.yaml` — project teams snapshot.
  - `paths_area.yaml` — flattened Area paths.
  - `paths_iteration.yaml` — flattened Iteration paths.
  - `wit_contract.yaml` — work item type fields and metadata.
  - `_sync_state.yaml` — sync metadata (timestamps, version, sections).

### `schema/`

Machine-readable contracts.

- `schema/bundle.schema.json` — JSON Schema for the canonical outbox bundle format.

### `outbox/`

File-based workflow for bundles.

- `outbox/ready/` — agent drops bundles here.
- `outbox/validated/` — bundles that pass validation (future command).
- `outbox/failed/` — bundles that fail validation + reports (future command).
- `outbox/archived/` — bundles successfully written + audit ref (future command).

### `audit/`

Structured audit artifacts emitted by `adoctl write` (future).

### `logs/`

Local log output (future: structured logs + redaction).

### Root files

- `environment.yml` — conda environment (pinned to Python `3.8.5`).
- `pyproject.toml` — packaging + CLI script definition (`adoctl`).
- `specs.md` — system specification and intended behavior.
- `AGENTS.md` — engineering constraints and the canonical bundle contract.
- `extract_ado.py` — legacy/prototype sync script (kept for reference/testing).

## Typical Developer Workflow

1) Sync ADO metadata into generated configs:

- Set PAT in env: `export ADO_PAT="..."`
- Run sync:
  - `python -m adoctl sync --org-url "https://dev.azure.com/<ORG>" --project "<PROJECT>" --all`

2) Validate outbox bundles (not implemented yet):

- Intended: schema → policy → ADO metadata validation; no ADO writes on failure.

3) Write work items (not implemented yet):

- Intended: `--dry-run` supported, create Features then User Stories, link via parent-child, audit always, fail fast.
