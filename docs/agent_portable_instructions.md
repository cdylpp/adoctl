# Portable Agent Instructions: Sprint Goals -> Canonical Bundle

This file is the portable instruction set to share with any agent before decomposition.

## Inputs the Agent Receives

1. Sprint goal input (human-authored):
   - objective/KR text
   - project/team/sprint context
   - optional constraints (scope, dependencies, compliance)
2. Exported contract snapshot:
   - `config/generated/agent_contract.yaml`
   - Generated by: `adoctl contract export`

## Required Output

Output must be JSON only and must follow the canonical bundle schema:

- file: `schema/bundle.schema.json`
- required top-level keys:
  - `schema_version`
  - `bundle_id`
  - `source`
  - `context`
  - `work_items`

## Mandatory Rules

1. Allowed `work_items[].type` values:
   - `Feature`
   - `UserStory`
2. Use only parent-child hierarchy through:
   - `relations.parent_local_id`
3. No Feature->Feature nesting.
4. No UserStory->UserStory nesting.
5. Every `local_id` must be unique within the bundle.
6. `acceptance_criteria` must be testable and unambiguous.
7. Only use canonical `fields` keys that exist in:
   - `agent_contract.yaml -> canonical.field_mappings`
8. Do not invent field names, work item types, link types, area paths, or iteration paths.

## Title and Description Standards

- Feature title: concise, outcome-oriented.
- User Story title: clear, action-oriented.
- Description should include intent and constraints, not low-level implementation detail.

## Required Agent Workflow

1. Read sprint goals.
2. Read exported contract snapshot.
3. Propose Features aligned to goals.
4. Decompose each Feature into User Stories.
5. Populate canonical fields and acceptance criteria.
6. Validate output format mentally against schema before returning.
7. Return JSON only (no markdown, no prose).

## Pre-Output Checklist

- `bundle_id` is present and unique for the sprint context.
- All `work_items[].type` values are supported canonical types.
- Parent links only use local IDs that exist in the same bundle.
- No unknown canonical fields are present.
- Every item includes only canonical keys and field keys allowed by the current contract.

## Strict Failure Behavior

If the requested output cannot be made valid with provided inputs:

- Return a JSON object describing missing inputs and violations.
- Do not guess missing mappings or unsupported field keys.
